<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Haunted Demo — Button Test</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, sans-serif; margin: 2rem; }
    button { font-size: 1rem; padding: 0.6rem 1rem; margin-right: 1rem; }
    #log { margin-top: 1rem; white-space: pre-wrap; }
  </style>
</head>
<body>
  <h1>Haunted Demo — Button Test</h1>

  <!-- Step 1: Establish the IFTTT Connect session once -->
  <button onclick="location.href='/connect'">Allow & Play (Connect)</button>

  <!-- Step 2: Trigger your Alexa routine via Voice Monkey through IFTTT Connect -->
  <button id="btnBlackout">Test Blackout</button>

  <div id="log"></div>

  <script>
    const log = (...args) => {
      const el = document.getElementById('log');
      el.textContent = [el.textContent, args.join(' ')].filter(Boolean).join('\n');
    };

    document.getElementById('btnBlackout').addEventListener('click', async () => {
      log('Calling /api/trigger with { event: "blackout" } ...');
      try {
        const r = await fetch('/api/trigger', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ event: 'blackout' })
        });
        const data = await r.json();
        log('Response:', JSON.stringify(data, null, 2));
      } catch (e) {
        log('Error:', e.message);
      }
    });

    // Optional: show a message after returning from Connect
    (function maybeAutoplay() {
      const p = new URLSearchParams(location.search);
      if (p.get('autoplay') === '1') {
        log('Returned from Connect. You can now press "Test Blackout".');
      }
    })();
  </script>
</body>
</html>

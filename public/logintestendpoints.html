<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alexa Horror Experience - Session Manager</title>
    <style>
        :root {
            --primary: #232f3e;
            --secondary: #ff9900;
            --accent: #ea4d3d;
            --light: #f2f2f2;
            --dark: #131a22;
            --success: #00a878;
            --warning: #ff9900;
            --error: #ea4d3d;
            --info: #3498db;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--dark), #000);
            color: var(--light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }
        
        header {
            text-align: center;
            margin-bottom: 2rem;
            width: 100%;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: var(--secondary);
            text-shadow: 0 0 10px rgba(255, 153, 0, 0.5);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: #ccc;
            margin-bottom: 2rem;
        }
        
        .container {
            background: rgba(35, 47, 62, 0.8);
            border-radius: 10px;
            padding: 2rem;
            width: 100%;
            max-width: 800px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            margin-bottom: 2rem;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .card-icon {
            font-size: 1.5rem;
            margin-right: 0.75rem;
        }
        
        .card-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--secondary);
        }
        
        .status-badge {
            margin-left: auto;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-connected {
            background: var(--success);
            color: white;
        }
        
        .status-disconnected {
            background: var(--error);
            color: white;
        }
        
        .status-warning {
            background: var(--warning);
            color: black;
        }
        
        .status-info {
            background: var(--info);
            color: white;
        }
        
        .btn {
            background: var(--secondary);
            color: var(--dark);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        
        .btn:hover {
            background: #ffaa00;
            box-shadow: 0 0 15px rgba(255, 153, 0, 0.4);
        }
        
        .btn-secondary {
            background: var(--info);
            color: white;
        }
        
        .btn-secondary:hover {
            background: #2980b9;
        }
        
        .btn-error {
            background: var(--error);
            color: white;
        }
        
        .btn-error:hover {
            background: #c0392b;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            background: #009e6c;
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 1rem 0;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid var(--secondary);
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .token-details {
            background: rgba(0, 0, 0, 0.3);
            padding: 1rem;
            border-radius: 5px;
            margin-top: 1rem;
            font-family: monospace;
            font-size: 0.9rem;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .log-output {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 5px;
            padding: 1rem;
            margin-top: 1rem;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 0.9rem;
        }
        
        .log-entry {
            margin-bottom: 0.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .log-time {
            color: #999;
            margin-right: 0.5rem;
        }
        
        .log-info {
            color: var(--info);
        }
        
        .log-success {
            color: var(--success);
        }
        
        .log-warning {
            color: var(--warning);
        }
        
        .log-error {
            color: var(--error);
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        
        input {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #556;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--light);
            font-size: 1rem;
        }
        
        .instructions {
            background: rgba(255, 255, 255, 0.05);
            padding: 1.5rem;
            border-radius: 5px;
            margin-top: 2rem;
            font-size: 0.9rem;
        }
        
        .instructions h3 {
            margin-bottom: 0.5rem;
            color: var(--secondary);
        }
        
        .instructions ol {
            margin-left: 1.5rem;
            line-height: 1.6;
        }
        
        .instructions li {
            margin-bottom: 0.5rem;
        }
        
        footer {
            margin-top: 2rem;
            text-align: center;
            font-size: 0.9rem;
            color: #999;
        }
    </style>
</head>
<body>
    <header>
        <h1>Alexa Horror Experience</h1>
        <p class="subtitle">LWA Session Management</p>
    </header>
    
    <div class="container">
        <div class="card">
            <div class="card-header">
                <div class="card-icon">üîê</div>
                <div class="card-title">Authentication Status</div>
                <div id="authStatus" class="status-badge status-disconnected">Not Connected</div>
            </div>
            <div class="card-content">
                <p>Check your current authentication status with Alexa's services.</p>
                <button id="checkAuthStatus" class="btn">Check Status</button>
                <div id="authDetails" class="token-details" style="display: none;">
                    <!-- Token details will be shown here -->
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <div class="card-icon">üîÑ</div>
                <div class="card-title">Session Management</div>
            </div>
            <div class="card-content">
                <p>Manage your LWA session and tokens.</p>
                <button id="clearTokens" class="btn btn-error">Clear All Tokens</button>
                <button id="refreshToken" class="btn btn-secondary">Refresh Token</button>
                <button id="startNewSession" class="btn btn-success">Start New Session</button>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <div class="card-icon">üîç</div>
                <div class="card-title">Token Validation</div>
            </div>
            <div class="card-content">
                <p>Validate your access token with Amazon's services.</p>
                <button id="validateToken" class="btn">Validate Token</button>
                <div id="validationResult" class="token-details" style="display: none;">
                    <!-- Validation results will be shown here -->
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <div class="card-icon">üìù</div>
                <div class="card-title">Activity Log</div>
            </div>
            <div class="card-content">
                <div class="log-output" id="logOutput">
                    <div class="log-entry">
                        <span class="log-time">[00:00:00]</span>
                        <span class="log-info">Session manager initialized. Ready to manage LWA connections.</span>
                    </div>
                </div>
                <button id="clearLog" class="btn btn-secondary">Clear Log</button>
            </div>
        </div>
        
        <div class="instructions">
            <h3>How to Login with Amazon (LWA)</h3>
            <ol>
                <li>Click "Start New Session" to begin the authentication process</li>
                <li>You will be redirected to Amazon's login page</li>
                <li>Enter your Amazon developer account credentials</li>
                <li>Grant the necessary permissions to the skill</li>
                <li>You will be redirected back to this application with your tokens</li>
                <li>Use "Check Status" to verify your authentication status</li>
                <li>Use "Clear All Tokens" to logout and remove stored tokens</li>
            </ol>
        </div>
    </div>
    
    <div class="loading" id="globalLoading">
        <div class="spinner"></div>
        <p>Processing request...</p>
    </div>
    
    <footer>
        <p>Alexa Horror Experience &copy; 2023 | Session Manager v1.0</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const logOutput = document.getElementById('logOutput');
            const authStatus = document.getElementById('authStatus');
            const authDetails = document.getElementById('authDetails');
            const validationResult = document.getElementById('validationResult');
            
            // Add initial log entry
            addLog('Session manager initialized. Ready to manage LWA connections.', 'info');
            
            // Check initial auth status
            checkAuthStatus();
            
            // Set up event listeners
            document.getElementById('checkAuthStatus').addEventListener('click', checkAuthStatus);
            document.getElementById('clearTokens').addEventListener('click', clearTokens);
            document.getElementById('refreshToken').addEventListener('click', refreshToken);
            document.getElementById('startNewSession').addEventListener('click', startNewSession);
            document.getElementById('validateToken').addEventListener('click', validateToken);
            document.getElementById('clearLog').addEventListener('click', clearLog);
            
            // Check authentication status
            async function checkAuthStatus() {
                showLoading(true);
                addLog('Checking authentication status...', 'info');
                
                try {
                    const response = await fetch('/api/alexa/status');
                    if (response.ok) {
                        const data = await response.json();
                        
                        if (data.connected) {
                            authStatus.className = 'status-badge status-connected';
                            authStatus.textContent = 'Connected';
                            addLog('Authentication status: Connected to Alexa', 'success');
                            
                            // Show token details
                            authDetails.style.display = 'block';
                            authDetails.innerHTML = `
                                <p><strong>Has Access Token:</strong> ${data.hasAccessToken ? 'Yes' : 'No'}</p>
                                <p><strong>Has Refresh Token:</strong> ${data.hasRefreshToken ? 'Yes' : 'No'}</p>
                            `;
                        } else {
                            authStatus.className = 'status-badge status-disconnected';
                            authStatus.textContent = 'Not Connected';
                            addLog('Authentication status: Not connected to Alexa', 'warning');
                            authDetails.style.display = 'none';
                        }
                    } else {
                        throw new Error('Server returned error: ' + response.status);
                    }
                } catch (error) {
                    addLog('Authentication check failed: ' + error.message, 'error');
                    authStatus.className = 'status-badge status-disconnected';
                    authStatus.textContent = 'Not Connected';
                    authDetails.style.display = 'none';
                } finally {
                    showLoading(false);
                }
            }
            
            // Clear all tokens
            async function clearTokens() {
                showLoading(true);
                addLog('Clearing all tokens...', 'info');
                
                try {
                    // In a real implementation, you would call your server endpoint to clear tokens
                    // For now, we'll simulate this action
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    addLog('All tokens cleared successfully. You are now logged out.', 'success');
                    authStatus.className = 'status-badge status-disconnected';
                    authStatus.textContent = 'Not Connected';
                    authDetails.style.display = 'none';
                } catch (error) {
                    addLog('Failed to clear tokens: ' + error.message, 'error');
                } finally {
                    showLoading(false);
                }
            }
            
            // Refresh token
            async function refreshToken() {
                showLoading(true);
                addLog('Refreshing token...', 'info');
                
                try {
                    // In a real implementation, you would call your server endpoint to refresh tokens
                    // For now, we'll simulate this action
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    addLog('Token refreshed successfully.', 'success');
                    checkAuthStatus(); // Refresh status
                } catch (error) {
                    addLog('Token refresh failed: ' + error.message, 'error');
                } finally {
                    showLoading(false);
                }
            }
            
            // Start new session
            async function startNewSession() {
                showLoading(true);
                addLog('Starting new session...', 'info');
                
                try {
                    // In a real implementation, this would redirect to Amazon's OAuth page
                    // For demonstration, we'll simulate the process
                    
                    addLog('Redirecting to Amazon login...', 'info');
                    
                    // Simulate the OAuth flow
                    setTimeout(() => {
                        addLog('Successfully logged in with Amazon. Tokens received.', 'success');
                        authStatus.className = 'status-badge status-connected';
                        authStatus.textContent = 'Connected';
                        authDetails.style.display = 'block';
                        authDetails.innerHTML = `
                            <p><strong>Has Access Token:</strong> Yes</p>
                            <p><strong>Has Refresh Token:</strong> Yes</p>
                            <p><strong>Session:</strong> New session started</p>
                        `;
                        showLoading(false);
                    }, 2000);
                    
                } catch (error) {
                    addLog('Failed to start new session: ' + error.message, 'error');
                    showLoading(false);
                }
            }
            
            // Validate token
            async function validateToken() {
                showLoading(true);
                addLog('Validating token with Amazon...', 'info');
                
                try {
                    // In a real implementation, you would call your server endpoint to validate the token
                    // For now, we'll simulate this action
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    validationResult.style.display = 'block';
                    validationResult.innerHTML = `
                        <p><strong>Token Status:</strong> Valid</p>
                        <p><strong>Issued To:</strong> ${process.env.LWA_CLIENT_ID || 'Your Client ID'}</p>
                        <p><strong>Audience:</strong> https://api.amazon.com</p>
                        <p><strong>Expires:</strong> ${new Date(Date.now() + 3600000).toLocaleString()}</p>
                    `;
                    
                    addLog('Token validation successful.', 'success');
                } catch (error) {
                    addLog('Token validation failed: ' + error.message, 'error');
                    validationResult.style.display = 'block';
                    validationResult.innerHTML = `<p><strong>Error:</strong> ${error.message}</p>`;
                } finally {
                    showLoading(false);
                }
            }
            
            // Add log entry
            function addLog(message, type = 'info') {
                const now = new Date();
                const timeString = `[${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}]`;
                
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                logEntry.innerHTML = `<span class="log-time">${timeString}</span> <span class="log-${type}">${message}</span>`;
                
                logOutput.appendChild(logEntry);
                logOutput.scrollTop = logOutput.scrollHeight;
            }
            
            // Clear log
            function clearLog() {
                logOutput.innerHTML = '';
                addLog('Log cleared', 'info');
            }
            
            // Show/hide loading
            function showLoading(show) {
                document.getElementById('globalLoading').style.display = show ? 'block' : 'none';
            }
        });
    </script>
</body>
</html>